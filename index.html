<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maxcdon.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MaxCheng&#39;blog">
<meta property="og:url" content="https://maxcdon.github.io/blog/index.html">
<meta property="og:site_name" content="MaxCheng&#39;blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Max Cheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://maxcdon.github.io/blog/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>MaxCheng'blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MaxCheng'blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">step by step</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2021/10/22/number/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/10/22/number/" class="post-title-link" itemprop="url">【JS浮点数】常见的JS浮点数精度问题及原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-10-22 14:50:34 / Modified: 14:58:49" itemprop="dateCreated datePublished" datetime="2021-10-22T14:50:34+08:00">2021-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70617c01fab34c4395d87f6eaefe162f~tplv-k3u1fbpfcp-zoom-crop-mark:1304:1304:1304:734.awebp?" alt="image.png"></p>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>最近在项目线上环境中收集到客户反馈数值输入后展示值少了<code>0.01</code>，收到反馈后立刻定位代码中问题所在，原因就是上一个版本中此数值输入框改成<strong>非四舍五入截取两位小数</strong>，使用的方法是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.floor(floatNum*<span class="number">100</span>)/<span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>这个看似没有什么问题的方法当<code>floatNum</code>的值为<code>1.15</code>时，就出现了 Js 浮点数精度引起的异常情况，看下图。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28fdee9d86554714b5c43a575408c223~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>可以看到 <code>1.15*100</code> 在 Js 中计算结果并非为 <code>115</code>而是<code>114.99999999999999</code>，由此通过 <code>Math.floor()</code>向下取整并除以<code>100</code>时得到的最终结果是<code>1.14</code>，与预期结果正好相差<code>0.01</code>。</p>
<p>定位到问题所在后立刻进行修复，决定抛弃的浮点数计算的方式，使用转换成字符串截取的方案。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 保留小数（不四舍五入）</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param </span>floatNum 输入值</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param </span>decimal 保留浮点数精度位数</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">formatDecimal(floatNum, decimal) &#123;</span><br><span class="line">    <span class="keyword">let</span> result = floatNum.toString();</span><br><span class="line">    <span class="keyword">const</span> index = result.indexOf(<span class="string">'.'</span>);</span><br><span class="line">    <span class="keyword">if</span> (index !== <span class="number">-1</span>) &#123;</span><br><span class="line">      result = result.substring(<span class="number">0</span>, decimal + index + <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = result.substring(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parseFloat</span>(result);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在问题解决后，决定对 Js 浮点数进行梳理，并列举一些可能遇到的精度问题。</p>
<h1 id="Js-浮点数"><a href="#Js-浮点数" class="headerlink" title="Js 浮点数"></a>Js 浮点数</h1><h2 id="标准与储存方式"><a href="#标准与储存方式" class="headerlink" title="标准与储存方式"></a>标准与储存方式</h2><p>Js 没有单独的浮点型，浮点数与整数都是通过 Number 类型表示，是遵循 <code>IEEE754标准</code>的 64 位双精度值，在二进制中 64 位由三个部分组成。</p>
<ul>
<li><p>sign bit（符号S）：用来表示正负号，0代表正数，1代表负数</p>
</li>
<li><p>exponent（指数E）：用来表示次方数，中间11位</p>
</li>
<li><p>mantissa（尾数M）：用来表示精确度, 超出的部分自动进一舍零，最后52位</p>
</li>
</ul>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/103ee6a0c5e6471fbdb84c4b0b025b9f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>在二进制的科学记数法中，<code>IEEE754标准</code>的 64 位双精度值数字被公式表示为：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c096c0960fd4259a7b281d42af8d29f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>在十进制的科学记数法中 <code>1 &lt;= M &lt; 10</code>，同理在二进制科学记数法中 <code>1 &lt;= M &lt; 2</code>，所以 M 的整数部分只能是 1， 可以舍去，M 只存储后面小数部分。指数 E 是 11 位，在大能表示的数是 <code>2047 (2^11 - 1)</code>，由于指数包含正与负，所以取中间值 <code>1023</code> 临界值，<code>[1024, 2047]</code> 表示正指数，<code>[0, 1022]</code> 表示负指数。</p>
<p>以 4.5 为例转换成二进制是 <code>100.1</code>，用二进制科学记数法表示就是 <code>1.001 * 2^2</code>。 代入公式 1.001 舍去 1 尾数 M 是 001，指数 E 是 2 + 1023 = 1025 (二进制 <code>10000000001</code>)，正数 S 取 0，所以组合在一起 4.5 在 IEEE754 双精度64位标准表示如下。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14003a64d4d74d599354d69acd1e45d0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"><br>图片源自于<a href="http://www.binaryconvert.com/result_double.html?decimal=052046053" target="_blank" rel="noopener">binaryconvert</a></p>
<h2 id="哪些常见的精度问题及背后原理"><a href="#哪些常见的精度问题及背后原理" class="headerlink" title="哪些常见的精度问题及背后原理"></a>哪些常见的精度问题及背后原理</h2><p>明白了 Js 中浮点数的标准与储存方式，再回到实际场景中看看有哪些常见的浮点数精度问题极其原因。</p>
<h3 id="场景一-0-1-0-2-0-3"><a href="#场景一-0-1-0-2-0-3" class="headerlink" title="场景一  0.1 + 0.2 != 0.3"></a>场景一  <code>0.1 + 0.2 != 0.3</code></h3><p>0.1、0.2 以及相加的和的<strong>二进制</strong>表示如下 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0.1 -&gt; 0.0001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1001 1010 (1001循环 进一舍零)</span><br><span class="line">0.2 -&gt; 0.0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 0011 010 (0011循环 进一舍零)</span><br><span class="line">相加 -&gt; 0.0100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 1100 111</span><br></pre></td></tr></table></figure>

<p>相加所得的值转换成<strong>十进制</strong>恰好为 <code>0.30000000000000004</code></p>
<p>(<a href="https://www.runoob.com/w3cnote/decimal-decimals-are-converted-to-binary-fractions.html" target="_blank" rel="noopener">十进制小数转化为二进制小数计算方式</a>)</p>
<p>(<a href="https://www.sojson.com/hexconvert.html" target="_blank" rel="noopener">十进制小数转化为二进制小数计算工具</a>)</p>
<h3 id="场景二-1-335-toFixed-2-1-33"><a href="#场景二-1-335-toFixed-2-1-33" class="headerlink" title="场景二 (1.335).toFixed(2) == 1.33"></a>场景二 <code>(1.335).toFixed(2) == 1.33</code></h3><p>浮点数精度和 toFixed 其实属于同一类问题，都是由于浮点数无法精确表示引起的，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1.335</span>).toPrecision(<span class="number">20</span>);    <span class="comment">// "1.3349999999999999645"</span></span><br></pre></td></tr></table></figure>

<p>toFixed() 方法实则是对 1.3349999999999999645 四舍五入保留两位小数</p>
<h3 id="场景三-大数问题61453901951867050-5-61453901951867060"><a href="#场景三-大数问题61453901951867050-5-61453901951867060" class="headerlink" title="场景三 大数问题61453901951867050 + 5 == 61453901951867060"></a>场景三 大数问题<code>61453901951867050 + 5 == 61453901951867060</code></h3><p>因为 Javascript 的数字存储使用了 IEEE 754 中规定的双精度浮点数数据类型，而这一数据类型能够安全存储 (2^53 - 1) 到 -(2^53 - 1) 之间的数值（包含边界值）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.MAX_SAFE_INTEGER === <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span> <span class="comment">// true 最大安全整数</span></span><br><span class="line"><span class="built_in">Number</span>.MIN_SAFE_INTEGER === -(<span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span>) <span class="comment">// true 最小安全整数</span></span><br></pre></td></tr></table></figure>

<p>这里安全存储的意思是指能够准确区分两个不相同的值，例如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Number</span>.MAX_SAFE_INTEGER + <span class="number">1</span> === <span class="built_in">Number</span>.MAX_SAFE_INTEGER + <span class="number">2</span> <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>将得到 true 的结果，而这在数学上是错误的<br>因为遵循 IEEE754 标准 JavaScript 中最大的安全整数 <strong>Number.MAX_SAFE_INTEGER</strong></p>
<p>在场景三中，其数值 61453901951867050 超过最大安全整数，导致相加结果不准确。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">61453901951867050</span> &gt; <span class="built_in">Number</span>.MAX_SAFE_INTEGER <span class="comment">// true</span></span><br></pre></td></tr></table></figure>


<h2 id="解决精度问题的方案"><a href="#解决精度问题的方案" class="headerlink" title="解决精度问题的方案"></a>解决精度问题的方案</h2><p>假如我们要判断 0.1 + 0.2 是否等于 0.3</p>
<p>可以判断两边之差的绝对值是否小于 <code>Number.EPSILON</code>（浮点数之间最小差，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.abs(<span class="number">0.1</span> + <span class="number">0.2</span> - <span class="number">0.3</span>) &lt; <span class="built_in">Number</span>.EPSILON <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>若小于  Number.EPSILON 则认为等式成立。</p>
<p>但这种方式只能判断两边等式是否成立，如需要计算浮点数的精确计算值还需要利用其他方法。</p>
<p>目前社区已经有了很多较为成熟的库，比如 <a href="https://github.com/MikeMcl/bignumber.js" target="_blank" rel="noopener">bignumber.js</a>，<a href="https://github.com/MikeMcl/decimal.js" target="_blank" rel="noopener">decimal.js</a>，以及 <a href="https://github.com/MikeMcl/big.js" target="_blank" rel="noopener">big.js</a> 等。我们可以根据自己的需求来选择对应的工具。这些库不仅解决了浮点数的运算精度问题，还支持了大数运算，并且修复了原生 toFixed 结果不准确的问题。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>感谢阅读，若有不足，欢迎指正。  </p>
<p>提前祝 XDM 1024 节快乐~</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p><a href="https://zh.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noopener">Wikipedia-IEEE754</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/73699947" target="_blank" rel="noopener">老生常谈之js浮点数精度</a></p>
<p><a href="https://juejin.cn/post/6844903572979597319" target="_blank" rel="noopener">JS中浮点数精度问题</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2021/03/31/git-rules/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/03/31/git-rules/" class="post-title-link" itemprop="url">【Git分支管理】配合阿里云云效流水线实现前端CI/DI</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-03-31 15:23:40 / Modified: 15:28:35" itemprop="dateCreated datePublished" datetime="2021-03-31T15:23:40+08:00">2021-03-31</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35b9ca4972f7459986df306882fd407a~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h1 id="分支类型"><a href="#分支类型" class="headerlink" title="分支类型"></a>分支类型</h1><ul>
<li><p>mater 分支：主分支也是保护分支，用于部署生产环境和预发环境，只能由 release 分支、hotfix 分支合并，为保证主分支的稳定性任何人都无法在此分支直接提交代码。</p>
</li>
<li><p>develop 分支：开发分支同样也是保护分支，保持最新开发完成代码的同步。</p>
</li>
<li><p>feature 分支：新功能的开发分支，基于 develop 分支创建，功能开发完成后合并入 develop 分支，命名格式  feature/module_user_date</p>
</li>
<li><p>release 分支：提测分支，基于 develop 分支创建，测试过程中的bug修复均在此分支提交，测试完成后合入 master 分支，命名格式 release/module_user_date</p>
</li>
<li><p>hotfix 分支：紧急修复分支，基于 master 分支创建，用于修复线上紧急 bug 和 开发紧急需求，完成后合入 master 分支，命名格式  hotfix/module_user_date</p>
</li>
</ul>
<h1 id="部署方式"><a href="#部署方式" class="headerlink" title="部署方式"></a>部署方式</h1><ul>
<li><p>联调环境：云效流水线点击运行选择远程分支部署</p>
</li>
<li><p>测试环境：云效流水线点击运行选择远程分支部署</p>
</li>
<li><p>预发环境：监听远程仓库 master 分支更新，自动触发部署</p>
</li>
<li><p>生产环境：监听远程仓库 master 分支更新，并且需要云效流水线点击确认部署</p>
</li>
<li><p>演示环境：监听远程仓库 master 分支更新，并且需要云效流水线点击确认部署</p>
</li>
</ul>
<h1 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h1><h2 id="正常排期流程"><a href="#正常排期流程" class="headerlink" title="正常排期流程"></a>正常排期流程</h2><h3 id="开发阶段"><a href="#开发阶段" class="headerlink" title="开发阶段"></a>开发阶段</h3><p>从 develop 分支检出 feature/module_user_date 功能分支进行开发，<br>开发完成后功能分支 merge 合入 develop 分支  </p>
<h3 id="提测阶段"><a href="#提测阶段" class="headerlink" title="提测阶段"></a>提测阶段</h3><p>从 develop 分支检出 release/module_user_date 提测分支<br>提测过程中在 release/module_user_date 分支提交代码<br>更新代码后通过云效流水线点击运行选择分支部署测试环境</p>
<h3 id="预发阶段"><a href="#预发阶段" class="headerlink" title="预发阶段"></a>预发阶段</h3><p>将测试通过的 release/module_user_date 提测分支 merge 合入 master分支<br>自动触发预发环境部署<br>此时修复 bug 从 master 分支检出 hotfix/module_user_date 修复分支<br>修复后合回 master 分支</p>
<h3 id="生产阶段"><a href="#生产阶段" class="headerlink" title="生产阶段"></a>生产阶段</h3><p>验收后的版本通过云效流水线手动触发生产环境、演示环境部署<br>将 master 分支合入 development 分支<br>并且删除远程仓库 feature/module_user_date、release/module_user_date、hotfix/module_user_date 三类分支</p>
<p>END</p>
<h2 id="紧急需求-紧急修复流程"><a href="#紧急需求-紧急修复流程" class="headerlink" title="紧急需求/紧急修复流程"></a>紧急需求/紧急修复流程</h2><h3 id="开发阶段-1"><a href="#开发阶段-1" class="headerlink" title="开发阶段"></a>开发阶段</h3><p>从 master 分支检出 hotfix/module_user_date 紧急功能分支进行开发</p>
<h3 id="提测阶段-1"><a href="#提测阶段-1" class="headerlink" title="提测阶段"></a>提测阶段</h3><p>将多个 hotfix/module_user_date 分支合并成一个<br>提测过程中在 hotfix/module_user_date 分支提交代码<br>更新代码后通过云效流水线手动选择分支部署测试环境</p>
<h3 id="预发阶段-1"><a href="#预发阶段-1" class="headerlink" title="预发阶段"></a>预发阶段</h3><p>将测试通过的 hotfix/module_user_date 提测分支 merge 合入 master分支<br>自动触发预发环境部署<br>此时修复 bug 从 master 分支检出 hotfix/module_user_date 修复分支<br>修复后合回 master 分支</p>
<h3 id="生产阶段-1"><a href="#生产阶段-1" class="headerlink" title="生产阶段"></a>生产阶段</h3><p>验收后的版本通过云效流水线手动触发生产环境、演示环境部署<br>将 master 分支合入 development 分支<br>并且删除远程仓库 hotfix/module_user_date 分支</p>
<p>END</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2021/02/28/protractor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/02/28/protractor/" class="post-title-link" itemprop="url">【前端E2E测试】上手Protractor 看这篇就够了</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-28 23:07:39" itemprop="dateCreated datePublished" datetime="2021-02-28T23:07:39+08:00">2021-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-01 10:08:29" itemprop="dateModified" datetime="2021-03-01T10:08:29+08:00">2021-03-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3478ff659a0a4b438865ec46559e6c40~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h1 id="关于-Protractor"><a href="#关于-Protractor" class="headerlink" title="关于 Protractor"></a>关于 Protractor</h1><p>介绍 Protractor之前需要先介绍一下端到端测试（E2E测试），端到端测试验证应用中的所有层。这不仅包括你的前端代码，还包括所有相关的后端服务和基础设施，它们更能代表你的用户所处的环境。通过测试用户操作如何影响应用，端到端测试通常是提高应用是否正常运行的信心的关键。<br>Protractor 是 Angular 和 AngularJS 应用程序的端到端测试框架，针对在真实浏览器中运行的应用程序运行测试，并与用户进行交互，具有以下特性。</p>
<h2 id="模拟用户真实测试流程"><a href="#模拟用户真实测试流程" class="headerlink" title="模拟用户真实测试流程"></a>模拟用户真实测试流程</h2><p>Protractor 建立在 WebDriverJS 之上，该 WebDriverJS 使用本机事件和特定于浏览器的驱动程序来与用户的应用程序进行交互。</p>
<h2 id="Angular-支持友好"><a href="#Angular-支持友好" class="headerlink" title="Angular 支持友好"></a>Angular 支持友好</h2><p>Protractor 支持特定于Angular的定位器策略，该策略使你无需进行任何设置即可测试特定于Angular的元素。</p>
<h2 id="自动等待"><a href="#自动等待" class="headerlink" title="自动等待"></a>自动等待</h2><p>不再需要为测试添加等待和休眠，Protractor 可以在网页完成待处理的任务后自动执行测试的下一步，因此你不必担心等待测试和网页同步。</p>
<h1 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h1><h2 id="安装-Node"><a href="#安装-Node" class="headerlink" title="安装 Node"></a>安装 Node</h2><p>Protractor 是一个  Node.js 项目，你需要先安装 Node 环境，这个前端的小伙伴相信都有，这里也还是贴一下 <a href="https://www.runoob.com/nodejs/nodejs-install-setup.html" target="_blank" rel="noopener">Node 安装教程</a>。</p>
<h2 id="安装-Jdk"><a href="#安装-Jdk" class="headerlink" title="安装 Jdk"></a>安装 Jdk</h2><p>由于官方文档教程将运行本地独立的 Selenium 服务器来控制浏览器进行测试，你将需要安装 Java 开发工具包（JDK）才能运行独立的Selenium 服务器。这个是 <a href="https://www.runoob.com/java/java-environment-setup.html" target="_blank" rel="noopener">Jdk安装教程</a> , 安装完成后可以通过从命令行运行 <code>java -version</code> 进行检查是否生效。</p>
<h2 id="安装-Protractor"><a href="#安装-Protractor" class="headerlink" title="安装 Protractor"></a>安装 Protractor</h2><p>完成基础环境的配置，接下来就可以全局安装 Protractor 框架主体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g protractor</span><br></pre></td></tr></table></figure>
<p>这个命令会安装两个工具， <code>Protractor</code> 和 <code>webdriver-manager</code>，安装后使用命令行 <code>protractor --version</code>检测是否生效。<br><code>webdriver-manager</code> 是一个辅助工具，可轻松获取正在运行的 Selenium Server 实例。你需要通过以下命令下载必要的二进制文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webdriver-manager update</span><br></pre></td></tr></table></figure>
<p>现在就可以启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webdriver-manager start</span><br></pre></td></tr></table></figure>
<p>这将启动 Selenium 服务器并输出一堆信息日志, 你的 Protractor 测试将向该服务器发送请求以控制本地浏览器。保持该服务器运行，你可以在 <code>http://localhost:4444/wd/hub</code> 上查看有关服务器状态的信息。</p>
<h1 id="官方用例"><a href="#官方用例" class="headerlink" title="官方用例"></a>官方用例</h1><p>创建一个空的项目文件夹，并在其中创建两个文件, 一个测试代码文件<code>spec.js</code>，一个配置文件 <code>conf.js</code>。<br>让我们从一个简单的测试开始，该测试跳转到示例 AngularJS 应用程序并检查其标题，这是示例“超级计算器”测试页面地址：<a href="http://juliemr.github.io/protractor-demo/" target="_blank" rel="noopener">http://juliemr.github.io/protractor-demo/</a>  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// spec.js</span></span><br><span class="line">describe(<span class="string">'Protractor Demo App'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'should have a title'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    browser.get(<span class="string">'http://juliemr.github.io/protractor-demo/'</span>);</span><br><span class="line"></span><br><span class="line">    expect(browser.getTitle()).toEqual(<span class="string">'Super Calculator'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>describe</code> 和 <code>it</code> 语法来自 <code>Jasmine</code> 框架， <code>browser</code>是 Protractor 创建的全局变量，用于执行浏览器级别的命令，例如使用<code>browser.get</code> 进行导航。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// conf.js</span></span><br><span class="line">exports.config = &#123;</span><br><span class="line">  framework: <span class="string">'jasmine'</span>,</span><br><span class="line">  seleniumAddress: <span class="string">'http://localhost:4444/wd/hub'</span>,</span><br><span class="line">  specs: [<span class="string">'spec.js'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个配置是告诉 Protractor 选用的测试框架（<code>framewrok</code>）、测试文件的名称（<code>spec</code>）以及 selenuim server 地址（<code>selenuimAddress</code>）。它指定我们将使用 Jasmine 测试框架，对所有其他配置使用默认设置，Chrome是默认浏览器。  </p>
<p>运行 Protractor 进行测试  </p>
<figure class="highlight plain"><figcaption><span>conf.js```  </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">你应该会看到一个Chrome浏览器窗口打开并导航到“计算器”，然后自行关闭。测试输出应为1个测试，1个断言，0个失败。恭喜，你已经进行了首次 protractor 测试！</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 语法解析</span><br><span class="line">网页的端到端测试的核心是查找 DOM 元素，与之交互以及获取有关应用程序当前状态的信息，以下是如何使用 Protractor 在 DOM 元素上定位和执行操作的基本语法。</span><br><span class="line">## 定位器（Locators）</span><br><span class="line">&#96;&#96;&#96;javascript</span><br><span class="line">&#x2F;&#x2F; 通过 class 查找元素</span><br><span class="line">by.css(&#39;.myclass&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 通过 id 查找元素</span><br><span class="line">by.id(&#39;myid&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 通过 name 查找元素</span><br><span class="line">by.name(&#39;field_name&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 通过 ng-model 查找元素</span><br><span class="line">&#x2F;&#x2F; 请注意，目前仅AngularJS应用支持此功能</span><br><span class="line">by.model(&#39;name&#39;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 查找绑定到给定变量的元素</span><br><span class="line">&#x2F;&#x2F; 请注意，目前仅AngularJS应用支持此功能</span><br><span class="line">by.binding(&#39;bindingname&#39;)</span><br></pre></td></tr></table></figure>
<p>定位器传递给 element 函数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element(by.css(<span class="string">'some-css'</span>));</span><br><span class="line">element(by.model(<span class="string">'item.name'</span>));</span><br><span class="line">element(by.binding(<span class="string">'item.name'</span>));</span><br></pre></td></tr></table></figure>
<p>使用 CSS 选择器作为定位器时，可以使用<code>$（）</code>快捷方式表示法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'my-css'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这相当于:</span></span><br><span class="line"></span><br><span class="line">element(by.css(<span class="string">'my-css'</span>));</span><br></pre></td></tr></table></figure>

<h2 id="触发事件（Action）"><a href="#触发事件（Action）" class="headerlink" title="触发事件（Action）"></a>触发事件（Action）</h2><p><code>element（）</code>函数返回一个ElementFinder对象， ElementFinder知道如何使用您作为参数传入的定位器来定位DOM元素，但实际上尚未这样做，在调用动作方法之前它不会与浏览器联系。 以下是最常见的触发方法：</p>
<h3 id="单个元素"><a href="#单个元素" class="headerlink" title="单个元素"></a>单个元素</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el = element(locator);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单击元素</span></span><br><span class="line">el.click();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将键值输入到元素（通常是 Input 框）。</span></span><br><span class="line">el.sendKeys(<span class="string">'my text'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除元素的值 (通常是 Input 框).</span></span><br><span class="line">el.clear();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 attribute 的值, 例如获取 Input 的 value</span></span><br><span class="line">el.getAttribute(<span class="string">'value'</span>);</span><br></pre></td></tr></table></figure>

<p>由于所有动作都是异步的，因此所有动作方法都返回一个Promise，因此要记录元素的文本，可以执行以下操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el = element(locator);</span><br><span class="line">el.getText().then(<span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(text);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>WebFinder 上 WebDriverJS 中可用的任何操作都可以在 ElementFinder 中使用，<a href="http://www.protractortest.org/#/api?view=webdriver.WebElement" target="_blank" rel="noopener">查看完整清单</a>。</p>
</blockquote>
<h3 id="元素列表"><a href="#元素列表" class="headerlink" title="元素列表"></a>元素列表</h3><p>要处理多个DOM元素，使用element.all函数，定位器作为其唯一参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element.all(by.css(<span class="string">'.selector'</span>)).then(<span class="function"><span class="keyword">function</span>(<span class="params">elements</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 查找器获取的是数组元素</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>element.all() 具有几个辅助方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元素的数量</span></span><br><span class="line">element.all(locator).count();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据 Index 获取元素</span></span><br><span class="line">element.all(locator).get(index);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一个和最后一个元素</span></span><br><span class="line">element.all(locator).first();</span><br><span class="line">element.all(locator).last();</span><br></pre></td></tr></table></figure>
<p>将 CSS 选择器用作定位器时，可以使用快捷方式 <code>$$（）</code>表示法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$$(<span class="string">'.selector'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这相当于:</span></span><br><span class="line"></span><br><span class="line">element.all(by.css(<span class="string">'.selector'</span>));</span><br></pre></td></tr></table></figure>

<h3 id="子元素"><a href="#子元素" class="headerlink" title="子元素"></a>子元素</h3><p>要查找子元素，只需将 element 和 element.all 函数链接在一起，如下所示：</p>
<p>使用单个定位器查找：</p>
<p>一个元素:</p>
<ul>
<li><p><code>element(by.css(&#39;some-css&#39;));</code><br>元素列表：</p>
</li>
<li><p><code>element.all(by.css(&#39;some-css&#39;));</code><br>使用链接的定位器查找：</p>
</li>
</ul>
<p>子元素：</p>
<ul>
<li><p><code>element(by.css(&#39;some-css&#39;)).element(by.tagName(&#39;tag-within-css&#39;));</code><br>查找子元素列表：</p>
</li>
<li><p><code>element(by.css(&#39;some-css&#39;)).all(by.tagName(&#39;tag-within-css&#39;));</code><br>也可以使用 get / first / last 进行链接，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element.all(by.css(<span class="string">'some-css'</span>)).first().element(by.tagName(<span class="string">'tag-within-css'</span>));</span><br><span class="line">element.all(by.css(<span class="string">'some-css'</span>)).get(index).element(by.tagName(<span class="string">'tag-within-css'</span>));</span><br><span class="line">element.all(by.css(<span class="string">'some-css'</span>)).first().all(by.tagName(<span class="string">'tag-within-css'</span>));</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2021/01/31/optimization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/01/31/optimization/" class="post-title-link" itemprop="url">【前端优化】首屏加载 9.2s 压缩至 3.6 s</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-31 22:18:47" itemprop="dateCreated datePublished" datetime="2021-01-31T22:18:47+08:00">2021-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-01 09:23:59" itemprop="dateModified" datetime="2021-03-01T09:23:59+08:00">2021-03-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c86cfa2a84a84b2b92f9117fce8000a0~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>随着业务的不断迭代，项目日渐壮大，为了给用户提供更优的体验，前端优化是我们避不开的话题。一个优秀的网站必然是拥有丰富功能的同时具有比较块的响应速度，想必我们浏览网页时都更喜欢丝般顺滑的感受。<br>作为前端工程师来说，项目优化主要关注一下几点：白屏时间、首屏时间、整页时间、DNS时间、CPU占用率。就我们目前项目而言采用 Angular 开发，首屏加载时间是 9.2 秒，这个速度对用户而言大大降低了使用体验，通过本次优化将首屏加载压缩至 3.6 秒，接下来将逐步阐述本次优化的过程。</p>
<h1 id="PageSpeed-Insights定位问题"><a href="#PageSpeed-Insights定位问题" class="headerlink" title="PageSpeed Insights定位问题"></a>PageSpeed Insights定位问题</h1><p>其实早在之前就有对项目首页优化的想法，因为前端优化这个概念相对庞大，范围涉及比较广，往往对着项目无从下手。我也是在优化之前阅读并借鉴了很多优秀的文章，最终找到了一个非常好用的工具-PageSpeed Insights for Chrome。这是一个谷歌浏览器插件，可以用来定位网页存在的性能问题，安装好把它加入到 DevTools 就可以开始愉快的找问题了。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd50caa16d4e4ec09e803c614ede34d8~tplv-k3u1fbpfcp-zoom-1.image" alt=""><br>以上图为例可看到 PageSpeed Insights 会把网页存在待优化的问题分类列出，并且每个类目下可以定位到具体的文件，这样一来原本很抽象的前端优化就很形象得呈现在我们眼前了。优化的方向主要分为代码压缩、浏览器缓存、静态资源压缩，方向明确了就可以开始围绕问题开始动手改造。</p>
<blockquote>
<p>前端优化总的来说还是离不开那句话，减少请求文件数量同时减小请求文件体积。</p>
</blockquote>
<h1 id="代码压缩"><a href="#代码压缩" class="headerlink" title="代码压缩"></a>代码压缩</h1><p>结合前端工程化思想，我姑且把代码压缩分为两大类，一类是项目使用打包工具构建时文件的的压缩，例如 Webpack 各种压缩 Plugin 的配置，另一类是对前端服务器传输响应的压缩配置，例如 Nginx 的 Gzip。</p>
<h2 id="Webpack-配置"><a href="#Webpack-配置" class="headerlink" title="Webpack 配置"></a>Webpack 配置</h2><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a5de634a37e46f79576769d3713c7f5~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p>
<p>由于 Angular-Cli 集成了内部集成了 Webpack，并且重新进行了封装，所以在 Angular 6.0+ 项目中，想要优化或者更改Webpack打包配置需要通过 Angular-Builders，这里需要我们单独安装包。当然如果是直接用Webpack打包的项目就可以直接省略这一步。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @angular-builders&#x2F;custom-webpack --save-dev</span><br><span class="line">npm install @angular-devkit&#x2F;build-angular --save-dev</span><br></pre></td></tr></table></figure>

<p>不需要再单独安装 webpack 和 webpack-dev-server，因为这两个是 @angular-devkit/build-angular 的依赖包，在安装 @angular-devkit/build-angular 会自动安装 webpack 和 webpack-dev-server。</p>
<p>安装完成后要更改 angular.json 文件配置，把我们之后要添加的 webpack 配置，加在运行（serve）和编译（build）命令里，那么关键的配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&quot;architect&quot;: &#123;</span><br><span class="line">        ......</span><br><span class="line">        &quot;build&quot;: &#123;</span><br><span class="line">            &quot;builder&quot;: &quot;@angular-builders&#x2F;custom-webpack:browser&quot;,</span><br><span class="line">            &quot;options&quot;: &#123;</span><br><span class="line">                &quot;customWebpackConfig&quot;: &#123;</span><br><span class="line">                    &quot;path&quot;: &quot;.&#x2F;webpack.config.js&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;serve&quot;: &#123;</span><br><span class="line">            &quot;builder&quot;: &quot;@angular-builders&#x2F;custom-webpack:dev-server&quot;,</span><br><span class="line">            &quot;options&quot;: &#123;</span><br><span class="line">                &quot;customWebpackConfig&quot;: &#123;</span><br><span class="line">                    &quot;path&quot;: &quot;.&#x2F;webpack.config.js&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>接着需要在根目录下创建配置文件，我这里把它命名为 webpack.config.js。到这一步链接 Angular和自定义 Webpack 配置的准备工作已经就位了，现在我们可以把需要的Webpack配置写进新建的文件中。<br>引入压缩插件，分别对 Js、Html、Css 进行压缩，Js压缩：<code>UglifyJsPlugin</code>，Html压缩<code>HtmlWebpackPlugin</code>，提取公共资源：<code>CommonsChunkPlugin</code>，提取css并压缩：<code>ExtractTextPlugin</code>  。</p>
<h2 id="配置Nginx压缩"><a href="#配置Nginx压缩" class="headerlink" title="配置Nginx压缩"></a>配置Nginx压缩</h2><p>因为我们的前端项目都是通过 Nginx 部署，所以我们还需要在 Nginx 上开启 Gzip 传输压缩，这能使传输的打包文件体积压缩至原来的1/4左右，效果非常明显。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gzip on;</span><br><span class="line">gzip_types text&#x2F;plain application&#x2F;javascriptapplication&#x2F;x-javascripttext&#x2F;css application&#x2F;xml text&#x2F;javascriptapplication&#x2F;x-httpd-php application&#x2F;vnd.ms-fontobject font&#x2F;ttf font&#x2F;opentype font&#x2F;x-woff image&#x2F;svg+xml;</span><br></pre></td></tr></table></figure>

<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3e4974df57a4eebb4a868374defbd17~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<p>配置好重新启动Nginx，当看到请求响应头中有 Content-Encoding: gzip，说明传输压缩配置已经生效，此时可以看到我们请求文件的大小已经压缩很多。</p>
<h1 id="静态资源压缩"><a href="#静态资源压缩" class="headerlink" title="静态资源压缩"></a>静态资源压缩</h1><h2 id="使用雪碧图"><a href="#使用雪碧图" class="headerlink" title="使用雪碧图"></a>使用雪碧图</h2><p>雪碧图的作用就是减少请求数，而且多张图片合在一起后的体积会少于多张图片的体积总和，这也是比较通用的图片压缩方案，推荐一款雪碧图生成工具<br><a href="https://www.toptal.com/developers/css/sprite-generator" target="_blank" rel="noopener">sprite-generator</a><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45823bedcf9c4c6789b0cdc46c4d176f~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h2 id="使用WebP格式图片"><a href="#使用WebP格式图片" class="headerlink" title="使用WebP格式图片"></a>使用WebP格式图片</h2><p>WebP 是 Google 团队开发的加快图片加载速度的图片格式，其优势体现在它具有更优的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量，同时具备了无损和有损的压缩模式、Alpha 透明以及动画的特性，在 JPEG 和 PNG 上的转化效果都相当优秀、稳定和统一。<br>同样推荐一个生成WebP格式的工具<br><a href="https://www.upyun.com/webp" target="_blank" rel="noopener">又拍云WebP</a><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/480a94c2987d44c69df9576a5cfc5954~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h2 id="使用-CDN-加载"><a href="#使用-CDN-加载" class="headerlink" title="使用 CDN 加载"></a>使用 CDN 加载</h2><p>内容分发网络是指一种透过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。<br>把项目中引用的外部资源包通过 CDN 方式引入，以来能减少项目打包文件体积，二来能提高资源请求速度，一举两得。</p>
<h1 id="页面渲染性能优化"><a href="#页面渲染性能优化" class="headerlink" title="页面渲染性能优化"></a>页面渲染性能优化</h1><h2 id="减少重排重绘"><a href="#减少重排重绘" class="headerlink" title="减少重排重绘"></a>减少重排重绘</h2><p>以下三种情况会导致页面重新渲染</p>
<ul>
<li>修改DOM</li>
<li>修改样式</li>
<li>用户事件<br>重新渲染就是重新布局和重新绘制，前者叫重排（reflow），后者叫重绘（repaint）。<br>重排和重绘会影响页面性能以及用户使用体验，所以需要尽量降低重排和重绘的频率，需要注意以下几个方面。</li>
<li>多个 DOM 的读操作尽量写在一起，不要在连续读操作中添加写操作。</li>
<li>如果样式是重排得到的，尽量缓存样式。</li>
<li>不要单一改变样式，最好通过 Class 统一改变。</li>
<li>尽量使用离线 DOM 来改变样式，完成后再将对象写入。</li>
<li>先将元素置为<code>display: none</code>，再对节点进行操作。</li>
<li>position 为 <code>absolute</code> 或 <code>fixed</code> 的元素重排开销比较下，因为不考虑其他元素的影响。</li>
<li>display:none 的节点不会被加入Render Tree, 而 visibility:hidden则会，所以，如果某个节点最开始是不显示的，设为display:none 是更优的。</li>
</ul>
<h2 id="避免CSS、JS阻塞"><a href="#避免CSS、JS阻塞" class="headerlink" title="避免CSS、JS阻塞"></a>避免CSS、JS阻塞</h2><p>谈论资源的阻塞时，我们要清楚，现代浏览器总是并行加载资源。例如，当 HTML 解析器被脚本阻塞时，解析器虽然会停止构建 DOM，但仍会识别该脚本后面的资源，并进行预加载。<br>默认情况下，CSS 被视为阻塞渲染的资源，这意味着浏览器不会渲染任何已处理的内容，直至 CSSOM 构建完毕<br>Javascript 不仅可以读取和修改DOM 属性，还可以读取和修改CSSOM 属性<br>存在阻塞的 CSS 资源时， 浏览器会延迟javascript 的执行和 Render Tree 构建。<br>当浏览器遇到一个script标记时，DOM 构建将暂停，直至脚本完成执行。<br>javascript 可以查询和修改 DOM 与 CSSOM<br>CSSOM 构建时，javascript 执行将暂停，直至 CSSOM 就绪。<br>所以，script 标签的位置很重要。实际使用时，可以遵循下面2个原则  </p>
<ul>
<li>CSS 资源优于 JS 资源引入  </li>
<li>JS 应尽量少影响 DOM 的构建</li>
</ul>
<p>改变 js 阻塞的方式有 defer 和 async<br><code>&lt;script defer&gt;&lt;/script&gt;</code><br>defer 方式加载 script, 不会阻塞 HTML 解析，等到 DOM 生成完毕且 script 加载完毕再执行 Js。<br><code>&lt;script async&gt;&lt;/script&gt;</code><br>async 属性表示异步执行引入的 JS，加载时不会阻塞 HTML解析，但是加载完成后立马执行，此时仍然会阻塞 load 事件。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>前端优化是一个长期的工程，以上也只是部分优化的内容与方向，未来也会保持对前端优化的关注，通过更全面的维度提高项目性能。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2020/12/18/summary-2020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/12/18/summary-2020/" class="post-title-link" itemprop="url">2020黑天鹅后学会拥抱变化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-18 10:10:09 / Modified: 10:31:05" itemprop="dateCreated datePublished" datetime="2020-12-18T10:10:09+08:00">2020-12-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60f5771c0bfe434c9a33d9a70746a2c4~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>仔细算来从事前端也有两年半之久，时间好快，并且感觉越来越快，因此也常常出现焦虑。这就像查理·芒格老爷子所说 </p>
<blockquote>
<p>人们总是担心时间过去得太快，而自己又聪明得太慢</p>
</blockquote>
<p>生活在如此快节奏的环境中，特别是在一线城市竞争异常激烈（杭州在今年荣升为新一线城市），在拼搏的同时当然也需要学会慢下来思考与总结。一直以来也没有好好把年度总结以文字得形式记录下来，那就从今年开始在这里记录下自己的经历和成长。</p>
<h1 id="“黑天鹅”事件"><a href="#“黑天鹅”事件" class="headerlink" title="“黑天鹅”事件"></a>“黑天鹅”事件</h1><p>过去一年多发生了几件比较重大的事，2019年末，在我进入社会初期，当时所在行业经历了比较大得动荡，遇到了职业生涯的一次“黑天鹅”事件。当时那段时间内心也比较郁闷，但是有一句话怎么说来着，当你从低谷中走出来来的每一步都会是你未来宝贵的经验，之后我也尽快调整好了自己的状态。2020年初，新冠疫情席卷全球，这样全球性的“黑天鹅”事件，对全世界都是极大的考验，但每一个地方都在积极抗疫，我在那时报名成为社区志愿者，输出了一份绵薄之力。<br>经历了社会中这些的洗礼，我也有了更深刻得认知，生活中总会充斥着一些不可抗拒的“黑天鹅”，我们能做的只有不断提高自己的抗风险能力，以保证有足够的勇气去拥抱变化。</p>
<h1 id="这一年做了什么"><a href="#这一年做了什么" class="headerlink" title="这一年做了什么"></a>这一年做了什么</h1><h2 id="新的平台"><a href="#新的平台" class="headerlink" title="新的平台"></a>新的平台</h2><p>经过一段时间的沉淀与尝试，我也开始迎接新的挑战。回望这一段时间，自己也是有很多收获，对前端的知识体系进行了系统得梳理与巩固，找到了自己得不足，让我在接下来的一年有更针对性的方案去学习补充。</p>
<h2 id="尝试写文章记录自己"><a href="#尝试写文章记录自己" class="headerlink" title="尝试写文章记录自己"></a>尝试写文章记录自己</h2><p>这一年中我尝试分享自己的成长轨迹，写文章确实是一种很好的总结方式，在这个过程中能够对所学知识进行复盘，每次看到自己写的文字还是会有小小的成就感。目前写的文章主要还是以自己记录为主，以后希望能够输出一些更高质量的文章，能够给他人分享有用的信息会是一件很有意义的事。</p>
<h2 id="拥有人生中第一辆车"><a href="#拥有人生中第一辆车" class="headerlink" title="拥有人生中第一辆车"></a>拥有人生中第一辆车</h2><p>这一年中，我拥有了人生中第一辆车，在周末带家人出去聚个餐，节假日约上三五好友来一场说走就走的自驾游，这些日常小事能给生活增添许多幸福感。但当我还沉浸在提车的喜悦之时，发现周围很多朋友都已经开始买房，大家都步履不停，自己也得迎头赶上才行。</p>
<h1 id="成长与收获"><a href="#成长与收获" class="headerlink" title="成长与收获"></a>成长与收获</h1><h2 id="推动团队发展"><a href="#推动团队发展" class="headerlink" title="推动团队发展"></a>推动团队发展</h2><p>跟过去相比，今年最大的改变就是从跟随团队一起发展，到如今推动团队共同进步。当我加入公司的第一天起，我就给自己定位为一名推动者，希望自己的加入不单单是分担一份工作量，而是能成为为团队赋能的角色。如何在工作中体现价值？这是疫情期间经常思考得一个问题，我想能够推动团队和产品变得更有价值，那就是自我价值最好得佐证。制定好目标是第一步，更重要得是执行，在新团队的一年中除了日常业务迭代之外，我还主导推动了一些优化。</p>
<h2 id="制定Git使用规范"><a href="#制定Git使用规范" class="headerlink" title="制定Git使用规范"></a>制定Git使用规范</h2><p>我加入团队时正值快速扩张时期，发现前端代码库中<code>Commit Message</code>和<code>Git分支管理</code>没有一个严格的规范，伴随着人数增加会必然会影响 Code Review 和版本分支管理效率，于是我推动团队使用 Angular 的 <code>Commit Message</code> 规范，并且优化的分支管理，保证团队能多任务线并行开发使用 Git 仓库，也提高了代码仓库安全性和可维护性。</p>
<h2 id="引入-Prettier-和-Eslint-规范代码格式"><a href="#引入-Prettier-和-Eslint-规范代码格式" class="headerlink" title="引入 Prettier 和 Eslint 规范代码格式"></a>引入 Prettier 和 Eslint 规范代码格式</h2><p>在统一 Git 使用格式之后，编码规范得统一也得跟上，在提升个人的编码习惯同时还能给之后重构代码的人提供极大得便利， 毕竟作为开发者谁都不希望某一天接盘一堆难以阅读的代码，这一点应该能引起很多共鸣吧。于是我在项目中引入 Prettier 和 Eslint 配合使用约定编码规范，通过 husky 监听 git commit 自动格式代码以及 ts 语法检测，以此保证每次提交到远程仓库的代码都是符合规范的。</p>
<h2 id="首页加载时间优化"><a href="#首页加载时间优化" class="headerlink" title="首页加载时间优化"></a>首页加载时间优化</h2><p>在面向的客户的 WEB 项目中，页面加载渲染的时间直接影响到产品的使用体验，期间也对项目首页加载时间进行了一次优化。通过静态资源优化（使用 WebP 格式图片以及雪碧图）、Nginx 服务器开启 Gzip 压缩、使用浏览器缓存、使用 CDN 加载等方式，将页面首次加载时间从9.3秒提升至3.5秒。这里推荐一个好用的页面性能检测 Chrome 插件 PageSpeed，当前端优化无从下手时，这个工具可以帮助我们检测页面性能还存在哪些不足，然后就可以按提示一步步优化。</p>
<h2 id="接入ARMS前端监控"><a href="#接入ARMS前端监控" class="headerlink" title="接入ARMS前端监控"></a>接入ARMS前端监控</h2><p>伴随着项目的成长，对线上环境得代码运行状况监控也是必要的，能够帮助我们提前发现问题并及时修复，保证线上环境的健康运行。我选择在项目中接入阿里云团队的 ARMS 前端监控，实时可视化监控多环境JS异常信息、页面加载效率、API接口调用信息，并且接入钉钉机器人接收异常警报，保证团队能够第一时间接收到报警信息。</p>
<h1 id="拓宽自己的视野"><a href="#拓宽自己的视野" class="headerlink" title="拓宽自己的视野"></a>拓宽自己的视野</h1><p>平时也常常会有焦虑，今年买了一些书籍送给自己，希望通过跟伟大得灵魂进行碰撞，能拓宽视野、提升认知。在阅读《穷查理宝典》时，查理的思维很多次让我感觉醍醐灌顶，价值投资的魅力也深深吸引我。在休闲放松时，最近也爱看《圆桌派》这个节目，里面前辈们探讨的话题往往就是我们生活中困扰着我们的事，他们的经验也能够为我提供一个新的角度。</p>
<h1 id="强大的内心也需要强健得体魄"><a href="#强大的内心也需要强健得体魄" class="headerlink" title="强大的内心也需要强健得体魄"></a>强大的内心也需要强健得体魄</h1><p>要说今年比较满意的事，那就是号召四位好友开始一起健身。以前也办过健身卡，但都没能坚持下来，这一次从十月份开始约定每周三天健身日，风雨无阻。每次想偷懒的时候就在内心狠狠骂自己，所以至今为止还没有缺卡记录，希望能够一直保持下去。</p>
<h1 id="给2021的自己定几个小目标"><a href="#给2021的自己定几个小目标" class="headerlink" title="给2021的自己定几个小目标"></a>给2021的自己定几个小目标</h1><ul>
<li>每月发表一篇技术文章</li>
<li>看完六本新书</li>
<li>坚持一周三次健身<br>目标不大，定要好好执行<br>俗话说流水不争先，争得是滔滔不绝</li>
</ul>
<h1 id="未来可期"><a href="#未来可期" class="headerlink" title="未来可期"></a>未来可期</h1><p>去坚持自己认可的事<br>去争取自己想要的东西<br>2021 共勉！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2020/11/29/arms/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/11/29/arms/" class="post-title-link" itemprop="url">阿里云ARMS前端监控Angular接入实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-29 17:11:01" itemprop="dateCreated datePublished" datetime="2020-11-29T17:11:01+08:00">2020-11-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-18 10:00:30" itemprop="dateModified" datetime="2020-12-18T10:00:30+08:00">2020-12-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6dc3e304a283430d83d372b8fb50faa0~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h1 id="为什么要引入前端监控？"><a href="#为什么要引入前端监控？" class="headerlink" title="为什么要引入前端监控？"></a>为什么要引入前端监控？</h1><p>用户访问业务时，整个访问过程大致可以分为三个阶段：页面生产时（服务器端状态）、页面加载时和页面运行时。为了保证线上业务稳定运行，我们会在服务器端对业务的运行状态进行各种监控。现有的服务器端监控系统相对已经很成熟，而页面加载和页面运行时的状态监控一直比较欠缺。例如：</p>
<ul>
<li>无法第一时间获知用户访问您的站点时遇到的错误。</li>
<li>各个国家、各个地区的用户访问您的站点的真实速度未知。</li>
<li>每个应用内有大量的异步数据调用，而它们的性能、成功率都是未知的。<br>随着前端项目工程化得发展，我们对前端项目的性能要求也越来越高，如果没有引入前端监控，团队对前端线上环境的运行状况是很抽象的。在之前的工作中，经常遇到用户在使用业务得过程中出现异常，此时无法很快得定位并复现用户遇到的问题，导致在维护中消耗了较大得工作量。如果有前端监控得存在我们就可以快速定位到异常并做出修复，能够大幅提升工作效率以及用户体验。</li>
</ul>
<h1 id="选择一款优秀的前端监控"><a href="#选择一款优秀的前端监控" class="headerlink" title="选择一款优秀的前端监控"></a>选择一款优秀的前端监控</h1><p>挑选前端监控之前，首先确定项目对监控得需求，在我们项目中需求大致分为几点：</p>
<ul>
<li>JS异常信息统计</li>
<li>页面加载效率分析</li>
<li>API接口调用信息统计</li>
<li>监控可视化呈现<br>针对这些需求，就可以有目标性地挑选一款符合项目的前端监控。目前开源的Sentry和阿里云团队的ARMS都是比较全面的监控，基本满足我们项目的需求。<h2 id="Sentry"><a href="#Sentry" class="headerlink" title="Sentry"></a>Sentry</h2>正如其名「哨兵」，可以实时监控生产环境上的系统运行状态，一旦发生异常会第一时间把报错的路由路径、错误所在文件等详细信息以邮件形式通知我们，并且利用错误信息的堆栈跟踪快速定位到需要处理的问题。</li>
</ul>
<p>优点：开源对各种前端框架的友好支持 (Vue、React、Angular)支持 SourceMap。Sentry 官方提供的免费服务有次数限制，达到一定限制后继续使用就需要收费，但是我们可以利用 Sentry 的开源库在自己的服务器上搭建服务，官方已经提供了完善的操作文档。</p>
<h2 id="ARMS"><a href="#ARMS" class="headerlink" title="ARMS"></a>ARMS</h2><p>ARMS前端监控专注于对Web场景、Weex场景和小程序场景的监控，从页面打开速度（测速）、页面稳定性（JS Error）和外部服务调用成功率（API）这三个方面监测Web和小程序页面的健康度。</p>
<p>优点：重点监控页面的加载过程和运行时状态，同时将页面加载性能、运行时异常以及API调用状态和耗时等数据，上报到日志服务器。之后借助ARMS提供的海量实时日志分析和处理服务，对当前线上所有真实用户的访问情况进行监控。最后通过直观的报表展示。</p>
<p>可以看出Sentry更加专注于异常信息处理，ARMS则从更多的维度统计系统信息，并且通过丰富得可视化呈现，由此看来ARMS在这个项目中是更优得选择。</p>
<h1 id="Angular项目接入ARMS监控"><a href="#Angular项目接入ARMS监控" class="headerlink" title="Angular项目接入ARMS监控"></a>Angular项目接入ARMS监控</h1><p>在选定监控框架后，就要开始着手接入项目了，ARMS文档有两种接入方式提供给我们选择:</p>
<h2 id="cdh方式为Web应用安装ARMS前端监控探针"><a href="#cdh方式为Web应用安装ARMS前端监控探针" class="headerlink" title="cdh方式为Web应用安装ARMS前端监控探针"></a>cdh方式为Web应用安装ARMS前端监控探针</h2><p>cdh的方式比较便捷，在阿里云后台创建好项目后，直接复制ARMS提供的<code>&lt;script&gt;</code>标签中代码至根页面的<code>&lt;body&gt;</code>标签中即可生效。cdh方式又分为异步加载和同步加载。</p>
<ul>
<li>异步加载：又称为非阻塞加载，表示浏览器在下载执行JS之后还会继续处理后续页面。若对页面性能的要求非常高，建议使用此方式。</li>
<li>同步加载：又称为阻塞加载，表示当前JS加载完毕后才会进行后续处理。如需捕捉从页面打开到关闭的整个过程中的JS错误和资源加载错误，建议cdh引入使用此方式。</li>
</ul>
<h2 id="npm方式为Web应用安装ARMS前端监控探针"><a href="#npm方式为Web应用安装ARMS前端监控探针" class="headerlink" title="npm方式为Web应用安装ARMS前端监控探针"></a>npm方式为Web应用安装ARMS前端监控探针</h2><p>我们项目中选择npm方式安装探针</p>
<p>在npm仓库中安装alife-logger</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install alife-logger --save</span><br></pre></td></tr></table></figure>

<p>SDK以<code>BrowserLogger.singleton</code>方式初始化</p>
<p>arms.ts</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> BrowserLogger <span class="keyword">from</span> <span class="string">'alife-logger'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">'src/environments/environment'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ARMS前端监控</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">let</span> logger = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> environmentType = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (environment.type) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'dev'</span>:</span><br><span class="line">    environmentType = <span class="string">'daily'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'local'</span>:</span><br><span class="line">    environmentType = <span class="string">'local'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'pre'</span>:</span><br><span class="line">    environmentType = <span class="string">'pre'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'rep'</span>:</span><br><span class="line">    environmentType = <span class="string">'gray'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'prod'</span>:</span><br><span class="line">    environmentType = <span class="string">'prod'</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (environment.type !== <span class="string">'local'</span>) &#123;</span><br><span class="line">    logger = BrowserLogger.singleton(&#123;</span><br><span class="line">      pid: <span class="string">'d465464j9@4caac5459*****'</span>, <span class="comment">// 项目唯一ID，由ARMS在创建站点时自动生成</span></span><br><span class="line">      appType: <span class="string">'web'</span>, <span class="comment">// 项目类型</span></span><br><span class="line">      imgUrl: <span class="string">'https://arms-retcode.aliyuncs.com/r.png?'</span>, <span class="comment">// 日志上传地址</span></span><br><span class="line">      sendResource: <span class="literal">true</span>, <span class="comment">// 上报页面静态资源</span></span><br><span class="line">      enableLinkTrace: <span class="literal">true</span>, <span class="comment">// 进行前后端链路追踪</span></span><br><span class="line">      behavior: <span class="literal">true</span>, <span class="comment">// 是否为了便于排查错误而记录报错的用户行为</span></span><br><span class="line">      enableSPA: <span class="literal">true</span>, <span class="comment">// 监听页面的hashchange事件并重新上报PV</span></span><br><span class="line">      useFmp: <span class="literal">true</span>, <span class="comment">// 采集首屏FMP</span></span><br><span class="line">      environment: environmentType, <span class="comment">// 当前环境</span></span><br><span class="line">      release: environment.version, <span class="comment">// 项目版本号</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">'init arms fail'</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> logger;</span><br></pre></td></tr></table></figure>

<p>在页面初始化的时候引入<code>arms.ts</code>重启项目就可以看到探针已经生效。<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2066816384bd474c94600488c7126456~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h2 id="Angular自定义异常处理"><a href="#Angular自定义异常处理" class="headerlink" title="Angular自定义异常处理"></a>Angular自定义异常处理</h2><p>当用户进入项目时ARMS就会把前端监控日志上报，在ARMS后台可以看到访问速度、UV和PV统计、API请求日志信息。<br>到这里原本以为一切搞定了，但是自测过程中发现JS错误信息无法自动上报，我立刻再去看了一遍ARMS的接入文档，发现文档上也没有关于Anuglar项目的接入教程。然后开始各种Goole也没有找到关于Angular接入ARMS的攻略，最后我只能加了官方钉钉群去咨询开发团队，得到了以下解答。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/144caeda666e446380cbe8eeaaae403c~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<p>根据这个线索，我终于定位到JS异常没有上报的原因，是因为Angular框架底层对JS抛出的异常进行统一捕获处理，所以ARMS无法监听到JS异常，我们需要通过ARMS提供的<code>error()</code>方法手动上报异常信息。</p>
<p><code>error()</code></p>
<p>调用error()接口来上报页面中的JS错误或使用者想关注的异常。一般情况下，SDK会监听页面全局的Error并调用此接口上报异常信息，但由于浏览器的同源策略往往无法获取错误的具体信息，此时就需要使用者手动上报。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arms.error(error, pos)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>描述</th>
<th>是否必选</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>error</td>
<td></td>
<td>Error</td>
<td>JS的Error对象</td>
<td>是</td>
</tr>
<tr>
<td>pos</td>
<td>Object</td>
<td>错误发生的位置，包含以下3个属性</td>
<td>否</td>
<td>无</td>
</tr>
<tr>
<td>pos.filename</td>
<td>String</td>
<td>错误发生的文件名</td>
<td>否</td>
<td>无</td>
</tr>
<tr>
<td>pos.lineno</td>
<td>Number</td>
<td>错误发生的行数</td>
<td>否</td>
<td>无</td>
</tr>
<tr>
<td>pos.colno</td>
<td>Number</td>
<td>错误发生的列数</td>
<td>否</td>
<td>无</td>
</tr>
</tbody></table>
<p>Angular提供了钩子让我们自定义异常处理，我们要做的就是创建一个类，该类实现<code>ErrorHandler</code>来自<code>@angular/core</code>程序包的接口。该类必须实现<code>handleError()</code>方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ErrorHandler &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> arms <span class="keyword">from</span> <span class="string">'./arms'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; environment &#125; <span class="keyword">from</span> <span class="string">'src/environments/environment'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalErrorhandler</span> <span class="title">implements</span> <span class="title">ErrorHandler</span> </span>&#123;</span><br><span class="line">  handleError(error) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (environment.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'prod'</span>:</span><br><span class="line">        arms.error(error);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'local'</span>:</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">'Error from global error handler'</span>, error);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">'Error from global error handler'</span>, error);</span><br><span class="line">        arms.error(error);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>app.modules.ts</code>，告诉Angular它应该使用我们的错误处理程序，可以通过在providers配置中添加以下条目来实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">providers: [</span><br><span class="line">  &#123; <span class="attr">provide</span>: ErrorHandler, <span class="attr">useClass</span>: GlobalErrorhandler &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>部署项目可以看到异常信息可以上报至ARMS后台，大功告成~</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d75f559944f4573a0a9b05d65291e10~tplv-k3u1fbpfcp-watermark.image" alt=""></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>感谢观看，若有不足望提出指正！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://maxcdon.github.io/blog/2020/05/20/prettier/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Max Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MaxCheng'blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/05/20/prettier/" class="post-title-link" itemprop="url">前端代码格式工具Prettier</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-20 15:36:17" itemprop="dateCreated datePublished" datetime="2020-05-20T15:36:17+08:00">2020-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-18 10:31:05" itemprop="dateModified" datetime="2020-12-18T10:31:05+08:00">2020-12-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://user-gold-cdn.xitu.io/2020/5/9/171f85d9f4172b99?imageView2/1/w/1304/h/734/q/85/format/webp/interlace/1" alt=""></p>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>考虑到团队新加入的小伙伴越来越多，多人协作开发的规范也得跟上。在此之前我们引入了Angular团队的Git使用规范，获得了不错的反响，接下来就需要对风格迥异的前端代码进行格式规范。</p>
<h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>prettier是目前前端代码格式化工具中最热门的，在选择插件时也是优先选择了它。我们的方案把prettier集成进代码并且配合着vscode上的prettier插件一同使用。</p>
<h2 id="项目引入prettier"><a href="#项目引入prettier" class="headerlink" title="项目引入prettier"></a>项目引入prettier</h2><p>首先需要在项目中安装prttier包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install prettier --save-dev --save-exact</span><br></pre></td></tr></table></figure>
<p>第二步在项目根目录下新建一个.prettier配置文件，配置文件可以是JSON、JS、YAML等格式，在这里我们选用的是JSON。然后就可以根据官方文档提供的配置项来制定我们格式规范。<br>prettier的可配置项不多，可以看<a href="https://prettier.io/docs/en/options.html" target="_blank" rel="noopener">官方文档</a>大致过一遍。<br><br>以下是我们的配置（注释只作展示使用，请勿复制进去）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;printWidth&quot;: 80, &#x2F;&#x2F; 超过最大值换行</span><br><span class="line">  &quot;tabWidth&quot;: 2, &#x2F;&#x2F; 缩进字节数</span><br><span class="line">  &quot;useTabs&quot;: false, &#x2F;&#x2F; 不使用缩进符，而使用空格</span><br><span class="line">  &quot;semi&quot;: true, &#x2F;&#x2F; 句末添加分号</span><br><span class="line">  &quot;singleQuote&quot;: true, &#x2F;&#x2F; 使用单引号代替双引号</span><br><span class="line">  &quot;proseWrap&quot;: &quot;preserve&quot;, &#x2F;&#x2F; 使用默认的折行标准</span><br><span class="line">  &quot;arrowParens&quot;: &quot;avoid&quot;, &#x2F;&#x2F; (x) &#x3D;&gt; &#123;&#125; 箭头函数参数只有一个时是否要有小括号。avoid：省略括号</span><br><span class="line">  &quot;bracketSpacing&quot;: true,  &#x2F;&#x2F; 在对象，数组括号与文字之间加空格 &quot;&#123; foo: bar &#125;&quot;</span><br><span class="line">  &quot;endOfLine&quot;: &quot;auto&quot;, &#x2F;&#x2F; 结尾是 \n \r \n\r auto</span><br><span class="line">  &quot;htmlWhitespaceSensitivity&quot;: &quot;css&quot;, &#x2F;&#x2F; 根据显示样式决定 html 要不要折行</span><br><span class="line">  &quot;jsxBracketSameLine&quot;: false, &#x2F;&#x2F; 在jsx中把&#39;&gt;&#39; 是否单独放一行</span><br><span class="line">  &quot;jsxSingleQuote&quot;: false, &#x2F;&#x2F; 在jsx中使用单引号代替双引号</span><br><span class="line">  &quot;trailingComma&quot;: &quot;es5&quot; &#x2F;&#x2F; 在对象或数组最后一个元素后面是否加逗号（在ES5中加尾逗号）</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到这里Prettier的基本配置就完成了，你可以测试一下配置是否生效。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prettier --write [file&#x2F;dir&#x2F;glob ...]</span><br></pre></td></tr></table></figure>
<p>执行命令如果看到文件按配置被格式化，说明你的prettier已经配置成功！<br>但是每一次格式化都需要手动输入命令触发，这样的体验并不是很完美。</p>
<h2 id="自动格式化Pre-commit-Hook"><a href="#自动格式化Pre-commit-Hook" class="headerlink" title="自动格式化Pre-commit Hook"></a>自动格式化Pre-commit Hook</h2><p>prettier官方文档提供了Pre-commit Hook，你可以把git add暂存的文件在被commit提交之前自动执行prettier格式化。</p>
<p>首先安装pretty-quick husky插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pretty-quick husky --save-dev</span><br></pre></td></tr></table></figure>
<p>然后在package.json中加入配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;husky&quot;: &#123;</span><br><span class="line">    &quot;hooks&quot;: &#123;</span><br><span class="line">      &quot;pre-commit&quot;: &quot;pretty-quick --staged&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用git提交测试文件，可以看到提交的文件自动被格式化。</p>
<h2 id="Vscode插件-Prettier-Code-formatter"><a href="#Vscode插件-Prettier-Code-formatter" class="headerlink" title="Vscode插件  Prettier - Code formatter"></a>Vscode插件  Prettier - Code formatter</h2><p>我们已经在项目中集成了prettier，并且使用钩子在git提交代码的时候自动格式化相应的文件，但是这样子只能在最后提交之后才能看到代码格式化的效果，很多同学都有使用编辑器格式化代码的习惯，我们也可以在vscode中同步prettier配置。</p>
<p>首先在vscode中安装插件 Prettier - Code formatter</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/5/9/171f84d906e7ea5f?w=687&h=158&f=png&s=19094" alt=""></p>
<p>然后在vscode的setting.json中引入prettier配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot;prettier&quot;: &#123;</span><br><span class="line">  &quot;printWidth&quot;: 80,</span><br><span class="line">  &quot;tabWidth&quot;: 2,</span><br><span class="line">  &quot;useTabs&quot;: false,</span><br><span class="line">  &quot;semi&quot;: true,</span><br><span class="line">  &quot;singleQuote&quot;: true,</span><br><span class="line">  &quot;proseWrap&quot;: &quot;preserve&quot;,</span><br><span class="line">  &quot;arrowParens&quot;: &quot;avoid&quot;,</span><br><span class="line">  &quot;bracketSpacing&quot;: true,</span><br><span class="line">  &quot;endOfLine&quot;: &quot;auto&quot;,</span><br><span class="line">  &quot;htmlWhitespaceSensitivity&quot;: &quot;css&quot;,</span><br><span class="line">  &quot;jsxBracketSameLine&quot;: false,</span><br><span class="line">  &quot;jsxSingleQuote&quot;: false,</span><br><span class="line">  &quot;trailingComma&quot;: &quot;es5&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>大功告成，此时vscode的格式化配置已经与我们项目集成的prettier同步了，接下来就可以愉快的编码了~</p>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>在多人协作的开发过程中有强规范来约定开发格式能够提升开发效率和易维护性。随着项目越来越壮大，需要优化和规范的点还非常多，欢迎伙伴们一起交流~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Max Cheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Max Cheng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
